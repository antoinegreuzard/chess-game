var _=Object.defineProperty;var F=(l,e,t)=>e in l?_(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var f=(l,e,t)=>F(l,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();var o=(l=>(l.WHITE="white",l.BLACK="black",l))(o||{}),u=(l=>(l.PAWN="pawn",l.ROOK="rook",l.KNIGHT="knight",l.BISHOP="bishop",l.QUEEN="queen",l.KING="king",l))(u||{});class C{constructor(e,t){this.color=e,this.type=t}isPathClear(e,t,s,i,n){const r=Math.sign(s-e),c=Math.sign(i-t);let a=e+r,h=t+c;for(;a!==s||h!==i;){if(n.getPiece(a,h)!==null)return!1;a+=r,h+=c}return!0}canCapture(e,t,s){const i=s.getPiece(e,t);return!i||i.color!==this.color}}class p extends C{constructor(t){super(t,u.ROOK);f(this,"hasMoved",!1)}isValidMove(t,s,i,n,r){return!(t===i||s===n)||!this.isPathClear(t,s,i,n,r)?!1:this.canCapture(i,n,r)}}class M extends C{constructor(e){super(e,u.KNIGHT)}isValidMove(e,t,s,i,n){const r=Math.abs(s-e),c=Math.abs(i-t);return(r===2&&c===1||r===1&&c===2)&&this.canCapture(s,i,n)}}class T extends C{constructor(e){super(e,u.BISHOP)}isValidMove(e,t,s,i,n){return Math.abs(s-e)===Math.abs(i-t)&&this.isPathClear(e,t,s,i,n)?this.canCapture(s,i,n):!1}}class x extends C{constructor(e){super(e,u.QUEEN)}isValidMove(e,t,s,i,n){return(e===s||t===i||Math.abs(s-e)===Math.abs(i-t))&&this.isPathClear(e,t,s,i,n)?this.canCapture(s,i,n):!1}}class y extends C{constructor(t){super(t,u.KING);f(this,"hasMoved",!1)}isValidMove(t,s,i,n,r){const c=Math.abs(i-t),a=Math.abs(n-s);if(c<=1&&a<=1){const h=r.getPiece(i,n);return this.canCapture(i,n,r)&&(!h||h.type!==u.KING)}if(!this.hasMoved&&a===0&&c===2){const h=i>t?1:-1,g=i>t?7:0,v=r.getPiece(g,s);if(v&&v instanceof p&&!v.hasMoved){for(let d=t+h;d!==g;d+=h)if(r.getPiece(d,s))return!1;if(!r.isKingInCheck(this.color)&&!r.isSquareUnderAttack(t+h,s,this.color)&&!r.isSquareUnderAttack(i,s,this.color))return!0}}return!1}}class w extends C{constructor(e){super(e,u.PAWN)}isValidMove(e,t,s,i,n){const r=this.color===o.WHITE?1:-1,c=this.color===o.WHITE?1:6,a=(i-t)*r,h=Math.abs(s-e);if(h===0&&a===1&&!n.getPiece(s,i))return(this.color===o.WHITE&&i===7||this.color===o.BLACK&&i===0)&&this.handlePromotion(s,i,n),!0;if(h===0&&a===2&&t===c&&!n.getPiece(s,i)&&!n.getPiece(e,t+r))return n.updateEnPassantTarget(e,t,s,i,this),!0;if(h===1&&a===1){if(n.getPiece(s,i)&&this.canCapture(s,i,n))return(this.color===o.WHITE&&i===7||this.color===o.BLACK&&i===0)&&this.handlePromotion(s,i,n),!0;if(n.isEnPassantMove(e,t,s,i))return!0}return!1}handlePromotion(e,t,s){const i=document.getElementById("promotionDialog");i&&(i.style.display="block",window.promote=n=>{i.style.display="none",s.promotePawn(e,t,n)})}}let R=[],$=[];function m(l){const e=document.getElementById("gameMessage");e.textContent=l,e.style.display="block"}function j(l,e){switch(l){case u.PAWN:return e===o.WHITE?"♙":"♟";case u.ROOK:return e===o.WHITE?"♖":"♜";case u.KNIGHT:return e===o.WHITE?"♘":"♞";case u.BISHOP:return e===o.WHITE?"♗":"♝";case u.QUEEN:return e===o.WHITE?"♕":"♛";case u.KING:return e===o.WHITE?"♔":"♚";default:return""}}function V(l,e){const t=document.getElementById("capturedWhite"),s=document.getElementById("capturedBlack"),i=j(l,e);e===o.WHITE?(R.push(i),t.textContent=R.join(" ")):($.push(i),s.textContent=$.join(" "))}class J{constructor(){f(this,"grid");f(this,"enPassantTarget",null);f(this,"halfMoveCount",0);this.grid=this.initializeBoard()}initializeBoard(){const e=Array(8).fill(null).map(()=>Array(8).fill(null));return e[0]=[new p(o.WHITE),new M(o.WHITE),new T(o.WHITE),new x(o.WHITE),new y(o.WHITE),new T(o.WHITE),new M(o.WHITE),new p(o.WHITE)],e[1]=Array(8).fill(null).map(()=>new w(o.WHITE)),e[7]=[new p(o.BLACK),new M(o.BLACK),new T(o.BLACK),new x(o.BLACK),new y(o.BLACK),new T(o.BLACK),new M(o.BLACK),new p(o.BLACK)],e[6]=Array(8).fill(null).map(()=>new w(o.BLACK)),e}setupInitialPosition(){this.clearBoard(),this.grid[0]=[new p(o.WHITE),new M(o.WHITE),new T(o.WHITE),new x(o.WHITE),new y(o.WHITE),new T(o.WHITE),new M(o.WHITE),new p(o.WHITE)],this.grid[1]=Array(8).fill(null).map(()=>new w(o.WHITE)),this.grid[7]=[new p(o.BLACK),new M(o.BLACK),new T(o.BLACK),new x(o.BLACK),new y(o.BLACK),new T(o.BLACK),new M(o.BLACK),new p(o.BLACK)],this.grid[6]=Array(8).fill(null).map(()=>new w(o.BLACK))}isWithinBounds(e,t){return e>=0&&e<8&&t>=0&&t<8}getPiece(e,t){return this.grid[t][e]}getValidMoves(e,t){let s=null;if(this.isWithinBounds(e,t)&&(s=this.getPiece(e,t)),!s)return[];const i=[];for(let n=0;n<8;n++)for(let r=0;r<8;r++)s.isValidMove(e,t,r,n,this)&&i.push({x:r,y:n});return i}getKingInCheck(){return this.isKingInCheck(o.WHITE)?this.findKing(o.WHITE):this.isKingInCheck(o.BLACK)?this.findKing(o.BLACK):null}movePiece(e,t,s,i){if(i<0||i>=this.grid.length||t<0||t>=this.grid.length||["__proto__","constructor","prototype"].includes(i.toString())||["__proto__","constructor","prototype"].includes(t.toString()))return!1;let n=null;if(this.isWithinBounds(e,t)&&(n=this.getPiece(e,t)),n&&n.isValidMove(e,t,s,i,this)){let r=null;if(this.isWithinBounds(s,i)&&(r=this.getPiece(s,i)),r&&r.type===u.KING)return!1;if(this.isEnPassantMove(e,t,s,i)&&this.captureEnPassant(e,t,s,i),n instanceof y&&Math.abs(s-e)===2){if(!this.isCastlingValid(n,e,t,s))return!1;this.handleCastling(s,t)}let c=null;return this.isWithinBounds(s,i)&&(c=this.getPiece(s,i)),this.grid[i][s]=n,this.grid[t][e]=null,this.isKingInCheck(n.color)?(this.grid[t][e]=n,this.grid[i][s]=c,!1):(n.type===u.PAWN||r?this.halfMoveCount=0:this.halfMoveCount++,this.grid[i][s]=n,this.grid[t][e]=null,(n instanceof y||n instanceof p)&&(n.hasMoved=!0),!0)}return!1}isCastlingValid(e,t,s,i){const n=i>t?1:-1,r=i>t?7:0;let c=null;if(this.isWithinBounds(r,s)&&(c=this.getPiece(r,s)),!(c instanceof p)||c.hasMoved||e.hasMoved)return!1;for(let a=t+n;a!==r;a+=n)if(this.getPiece(a,s))return!1;for(let a=t;a!==i+n;a+=n)if(this.isSquareUnderAttack(a,s,e.color))return!1;return!0}handleCastling(e,t){e===6?this.getPiece(7,t)instanceof p&&this.movePiece(7,t,5,t):e===2&&this.getPiece(0,t)instanceof p&&this.movePiece(0,t,3,t)}updateEnPassantTarget(e,t,s,i,n){n instanceof w&&Math.abs(i-t)===2&&e===s?this.enPassantTarget={x:s,y:(t+i)/2}:this.enPassantTarget=null}captureEnPassant(e,t,s,i){const n=this.getPiece(e,t);if(this.isEnPassantMove(e,t,s,i)&&n instanceof w){const r=n.color===o.WHITE?-1:1,c=i+r,a=this.getPiece(s,c);a&&a.type===u.PAWN&&(this.grid[c][s]=null,V(a.type,a.color)),this.grid[i][s]=n,this.grid[t][e]=null}}isEnPassantMove(e,t,s,i){return this.enPassantTarget?this.getPiece(e,t)instanceof w&&s===this.enPassantTarget.x&&i===this.enPassantTarget.y&&Math.abs(e-s)===1&&Math.abs(t-i)===1:!1}promotePawn(e,t,s){var n;const i=(n=this.getPiece(e,t))==null?void 0:n.color;if(i)switch(s){case"queen":this.grid[t][e]=new x(i);break;case"rook":this.grid[t][e]=new p(i);break;case"bishop":this.grid[t][e]=new T(i);break;case"knight":this.grid[t][e]=new M(i);break}}isKingInCheck(e){const t=this.findKing(e);if(!t)return!1;for(let s=0;s<8;s++)for(let i=0;i<8;i++){const n=this.getPiece(i,s);if(n&&n.color!==e&&n.isValidMove(i,s,t.x,t.y,this))return!0}return!1}isCheckmate(e){if(!this.isKingInCheck(e))return!1;for(let t=0;t<8;t++)for(let s=0;s<8;s++){const i=this.getPiece(s,t);if(i&&i.color===e){for(let n=0;n<8;n++)for(let r=0;r<8;r++)if(i.isValidMove(s,t,r,n,this)){const c=this.getPiece(r,n);this.grid[n][r]=i,this.grid[t][s]=null;const a=!this.isKingInCheck(e);if(this.grid[t][s]=i,this.grid[n][r]=c,a)return!1}}}return!0}isStalemate(e){if(this.isKingInCheck(e))return!1;for(let t=0;t<8;t++)for(let s=0;s<8;s++){const i=this.getPiece(s,t);if(i&&i.color===e){for(let n=0;n<8;n++)for(let r=0;r<8;r++)if(i.isValidMove(s,t,r,n,this)){const c=this.getPiece(r,n);this.grid[n][r]=i,this.grid[t][s]=null;const a=!this.isKingInCheck(e);if(this.grid[t][s]=i,this.grid[n][r]=c,a)return!1}}}return!0}findKing(e){for(let t=0;t<8;t++)for(let s=0;s<8;s++){const i=this.getPiece(s,t);if(i&&i instanceof y&&i.color===e)return{x:s,y:t}}return null}isSquareUnderAttack(e,t,s){for(let i=0;i<8;i++)for(let n=0;n<8;n++){const r=this.getPiece(n,i);if(r&&r.color!==s&&r.isValidMove(n,i,e,t,this))return!0}return!1}isInsufficientMaterial(){const e=this.grid.flat().filter(t=>t!==null);return e.length<=2?!0:e.length===3&&e.some(t=>(t==null?void 0:t.type)===u.BISHOP||(t==null?void 0:t.type)===u.KNIGHT)}isFiftyMoveRule(){return this.halfMoveCount>=50}setPiece(e,t,s){this.grid[t][e]=s}clearBoard(){for(let e=0;e<8;e++)for(let t=0;t<8;t++)this.grid[e][t]=null}isMoveValid(e,t,s,i){const n=this.getPiece(e,t);if(!n||s<0||s>=8||i<0||i>=8||!n.isValidMove(e,t,s,i,this))return!1;const r=this.getPiece(s,i);return!(r&&r.color===n.color)}isCapture(e,t,s,i){const n=this.isWithinBounds(e,t)?this.getPiece(e,t):null,r=this.isWithinBounds(s,i)?this.getPiece(s,i):null;return n!==null&&r!==null&&n.color!==r.color}}const Z={[u.PAWN]:1,[u.KNIGHT]:3,[u.BISHOP]:3.25,[u.ROOK]:5,[u.QUEEN]:9,[u.KING]:0},b={[u.PAWN]:[[0,0,0,0,0,0,0,0],[.5,.5,.5,.5,.5,.5,.5,.5],[.1,.1,.2,.3,.3,.2,.1,.1],[.05,.05,.1,.25,.25,.1,.05,.05],[0,0,0,.2,.2,0,0,0],[.05,-.05,-.1,0,0,-.1,-.05,.05],[.05,.1,.1,-.2,-.2,.1,.1,.05],[0,0,0,0,0,0,0,0]],[u.KNIGHT]:[[-.5,-.4,-.3,-.3,-.3,-.3,-.4,-.5],[-.4,-.2,0,0,0,0,-.2,-.4],[-.3,0,.1,.15,.15,.1,0,-.3],[-.3,.05,.15,.2,.2,.15,.05,-.3],[-.3,0,.15,.2,.2,.15,0,-.3],[-.3,.05,.1,.15,.15,.1,.05,-.3],[-.4,-.2,0,.05,.05,0,-.2,-.4],[-.5,-.4,-.3,-.3,-.3,-.3,-.4,-.5]],[u.BISHOP]:[[-.2,-.1,-.1,-.1,-.1,-.1,-.1,-.2],[-.1,0,0,0,0,0,0,-.1],[-.1,0,.05,.1,.1,.05,0,-.1],[-.1,.05,.05,.1,.1,.05,.05,-.1],[-.1,0,.1,.1,.1,.1,0,-.1],[-.1,.1,.1,.1,.1,.1,.1,-.1],[-.1,.05,0,0,0,0,.05,-.1],[-.2,-.1,-.1,-.1,-.1,-.1,-.1,-.2]],[u.ROOK]:[[0,0,0,0,0,0,0,0],[.05,.1,.1,.1,.1,.1,.1,.05],[-.05,0,0,0,0,0,0,-.05],[-.05,0,0,0,0,0,0,-.05],[-.05,0,0,0,0,0,0,-.05],[-.05,0,0,0,0,0,0,-.05],[-.05,0,0,0,0,0,0,-.05],[0,0,0,.05,.05,0,0,0]],[u.QUEEN]:[[-.2,-.1,-.1,-.05,-.05,-.1,-.1,-.2],[-.1,0,0,0,0,0,0,-.1],[-.1,0,.05,.05,.05,.05,0,-.1],[-.05,0,.05,.05,.05,.05,0,-.05],[0,0,.05,.05,.05,.05,0,-.05],[-.1,.05,.05,.05,.05,.05,0,-.1],[-.1,0,.05,0,0,0,0,-.1],[-.2,-.1,-.1,-.05,-.05,-.1,-.1,-.2]],[u.KING]:[[-.3,-.4,-.4,-.5,-.5,-.4,-.4,-.3],[-.3,-.4,-.4,-.5,-.5,-.4,-.4,-.3],[-.3,-.4,-.4,-.5,-.5,-.4,-.4,-.3],[-.3,-.4,-.4,-.5,-.5,-.4,-.4,-.3],[-.2,-.3,-.3,-.4,-.4,-.3,-.3,-.2],[-.1,-.2,-.2,-.2,-.2,-.2,-.2,-.1],[.2,.2,0,0,0,0,.2,.2],[.2,.3,0,0,0,0,.3,.2]]},W={"3,3":.5,"3,4":.5,"4,3":.5,"4,4":.5,"2,3":.25,"2,4":.25,"3,2":.25,"4,2":.25,"4,5":.25,"3,5":.25,"5,3":.25,"5,4":.25};function H(l,e){let t=0;for(let s=0;s<8;s++)for(let i=0;i<8;i++){const n=l.getPiece(i,s);if(n){let r=Z[n.type];const c=b[n.type];c&&(r+=c[s][i]);const a=`${i},${s}`;W[a]&&(r+=W[a]),n.type===u.PAWN&&(r+=X(l,i,s,n.color)),n.type===u.BISHOP&&te(l,n.color)&&(r+=.5),ie(l,i,s,n.color)&&(r-=.5),t+=n.color===e?r:-r}}return t}function X(l,e,t,s){let i=0;return i-=Y(l,e,t,s)*1.5,i-=ee(l,e,t,s)*1.5,i}function Y(l,e,t,s){var i,n;for(let r=0;r<8;r++)if(r!==t&&((i=l.getPiece(e,r))==null?void 0:i.type)===u.PAWN&&((n=l.getPiece(e,r))==null?void 0:n.color)===s)return .5;return 0}function ee(l,e,t,s){const i=e-1>=0?l.getPiece(e-1,t):null,n=e+1<8?l.getPiece(e+1,t):null;return(!i||i.type!==u.PAWN||i.color!==s)&&(!n||n.type!==u.PAWN||n.color!==s)?1.5:0}function te(l,e){return se(l,e).filter(s=>s.type===u.BISHOP).length===2}function ie(l,e,t,s){const i=l.getPiece(e,t);return i&&i.type===u.KING?[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1}].some(({dx:r,dy:c})=>{const a=e+r,h=t+c;if(l.isWithinBounds(a,h)){const g=l.getPiece(a,h);return!g||g.color!==s||g.type===u.KING}return!0}):!1}function se(l,e){const t=[];for(let s=0;s<8;s++)for(let i=0;i<8;i++){const n=l.getPiece(i,s);n&&n.color===e&&t.push(n)}return t}class ne{constructor(e,t=5e3){f(this,"transpositionTable");f(this,"maxTime");f(this,"startTime");f(this,"killerMoves");this.color=e,this.transpositionTable=new Map,this.maxTime=t,this.killerMoves={},this.startTime=0}makeMove(e){let t=null,s=-1/0;const i=7;this.startTime=Date.now();for(let n=1;n<=i;n++){let r=this.getAllValidMoves(e);r=this.sortMoves(r,e,n);for(const c of r){const a=e.getPiece(c.fromX,c.fromY),h=e.getPiece(c.toX,c.toY);e.movePiece(c.fromX,c.fromY,c.toX,c.toY);const g=this.minimax(e,n-1,-1/0,1/0,!1);if(e.setPiece(c.fromX,c.fromY,a),e.setPiece(c.toX,c.toY,h),g>s&&(s=g,t=c),Date.now()-this.startTime>this.maxTime)break}if(Date.now()-this.startTime>this.maxTime)break}return t}minimax(e,t,s,i,n){const r=e.toString();if(Date.now()-this.startTime>this.maxTime)return H(e,this.color);if(this.transpositionTable.has(r))return this.transpositionTable.get(r);if(t===0||e.isCheckmate(this.color)||e.isCheckmate(this.getOpponentColor())||Date.now()-this.startTime>this.maxTime){const c=this.quiescenceSearch(e,s,i);return this.transpositionTable.set(r,c),c}if(e.isKingInCheck(this.color)&&this.getAllValidMoves(e).length===0)return-1/0;if(n){let c=-1/0,a=this.getAllValidMoves(e);a=this.sortMoves(a,e,t);for(const h of a){const g=e.getPiece(h.fromX,h.fromY),v=e.getPiece(h.toX,h.toY);e.movePiece(h.fromX,h.fromY,h.toX,h.toY);const d=this.minimax(e,t-1,s,i,!1);if(e.setPiece(h.fromX,h.fromY,g),e.setPiece(h.toX,h.toY,v),c=Math.max(c,d),s=Math.max(s,d),i<=s){this.addKillerMove(t,h);break}}return this.transpositionTable.set(r,c),c}else{let c=1/0,a=this.getAllValidMoves(e);a=this.sortMoves(a,e,t);for(const h of a){const g=e.getPiece(h.fromX,h.fromY),v=e.getPiece(h.toX,h.toY);e.movePiece(h.fromX,h.fromY,h.toX,h.toY);const d=this.minimax(e,t-1,s,i,!0);if(e.setPiece(h.fromX,h.fromY,g),e.setPiece(h.toX,h.toY,v),c=Math.min(c,d),i=Math.min(i,d),i<=s){this.addKillerMove(t,h);break}}return this.transpositionTable.set(r,c),c}}addKillerMove(e,t){this.killerMoves[e]||(this.killerMoves[e]=[]),this.killerMoves[e].push(t)}quiescenceSearch(e,t,s,i=0){if(i>=10)return H(e,this.color);const r=H(e,this.color);if(r>=s)return s;t<r&&(t=r);const c=this.getAllValidMoves(e).filter(a=>e.isCapture(a.fromX,a.fromY,a.toX,a.toY));for(const a of c){const h=e.getPiece(a.fromX,a.fromY),g=e.getPiece(a.toX,a.toY);if(e.movePiece(a.fromX,a.fromY,a.toX,a.toY),!e.isKingInCheck(this.color)){const d=-this.quiescenceSearch(e,-s,-t,i+1);if(e.setPiece(a.fromX,a.fromY,h),e.setPiece(a.toX,a.toY,g),d>=s)return s;d>t&&(t=d)}else e.setPiece(a.fromX,a.fromY,h),e.setPiece(a.toX,a.toY,g)}return t}getOpponentColor(){return this.color===o.WHITE?o.BLACK:o.WHITE}getAllValidMoves(e){const t=[];for(let s=0;s<8;s++)for(let i=0;i<8;i++){const n=e.getPiece(i,s);if(n&&n.color===this.color){const r=e.getValidMoves(i,s);for(const c of r)if(e.isMoveValid(i,s,c.x,c.y)){const a=e.getPiece(c.x,c.y);e.setPiece(c.x,c.y,n),e.setPiece(i,s,null);const h=!e.isKingInCheck(this.color);e.setPiece(i,s,n),e.setPiece(c.x,c.y,a),h&&t.push({fromX:i,fromY:s,toX:c.x,toY:c.y})}}}return t}sortMoves(e,t,s){return e.sort((i,n)=>{if(this.killerMoves[s]&&this.killerMoves[s].some(g=>g.fromX===i.fromX&&g.fromY===i.fromY))return-1;const r=t.getPiece(i.toX,i.toY),c=t.getPiece(n.toX,n.toY);if(r&&!c)return-1;if(!r&&c)return 1;const a=W[`${i.toX},${i.toY}`]||0;return(W[`${n.toX},${n.toY}`]||0)-a})}}class re{constructor(){f(this,"board");f(this,"ai");this.board=new J,this.ai=new ne(o.BLACK)}getBoard(){return this.board}makeAIMove(){if(this.ai){const e=this.ai.makeMove(this.board);if(e){const t=this.board.getPiece(e.toX,e.toY);t&&V(t.type,t.color),this.board.movePiece(e.fromX,e.fromY,e.toX,e.toY)}else{let t=o.WHITE;const s=t===o.WHITE?o.BLACK:o.WHITE;this.board.isKingInCheck(s)&&(this.board.isCheckmate(s)?(E(),m(`Échec et Mat ! ${t===o.WHITE?"Blanc":"Noir"} gagne !`)):m(`Échec au ${s===o.WHITE?"Blanc":"Noir"} !`))}}}}class oe{constructor(e,t,s){f(this,"canvas");f(this,"context");f(this,"tileSize");f(this,"draggingPiece",null);f(this,"startX",null);f(this,"startY",null);f(this,"highlightedMoves",[]);f(this,"kingInCheckPosition",null);this.board=e,this.moveHandler=s,this.canvas=document.getElementById(t),this.context=this.canvas.getContext("2d"),this.tileSize=this.canvas.width/8,this.canvas.style.cursor="default",this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this))}animateMove(e,t,s,i,n){let c=0;const a=e*this.tileSize,h=t*this.tileSize,g=(s-e)*this.tileSize/10,v=(i-t)*this.tileSize/10,d=()=>{c<=10?(this.drawBoard(),this.context.fillStyle=n.color===o.WHITE?"white":"black",this.context.font="48px Arial",this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText(this.getPieceText(n),a+g*c+this.tileSize/2,h+v*c+this.tileSize/2),c++,requestAnimationFrame(d)):this.drawBoard()};d()}highlightValidMoves(e){this.context.fillStyle="rgba(0, 255, 0, 0.5)",e.forEach(t=>{this.context.fillRect(t.x*this.tileSize,t.y*this.tileSize,this.tileSize,this.tileSize)})}drawBoard(){const e=this.board.getKingInCheck();this.kingInCheckPosition=e?{x:e.x,y:e.y}:null,this.drawTiles(),this.drawPieces()}drawTiles(){for(let e=0;e<8;e++)for(let t=0;t<8;t++){let i=(t+e)%2===1?"#769656":"#eeeed2";this.kingInCheckPosition&&this.kingInCheckPosition.x===t&&this.kingInCheckPosition.y===e&&(i="#ff6347"),this.context.fillStyle=i,this.context.fillRect(t*this.tileSize,e*this.tileSize,this.tileSize,this.tileSize)}}drawPieces(){for(let e=0;e<8;e++)for(let t=0;t<8;t++){const s=this.board.getPiece(t,e);s&&this.drawPiece(s,t,e)}}drawPiece(e,t,s){this.context.fillStyle=e.color==="white"?"white":"black",this.context.font="48px Arial",this.context.textAlign="center",this.context.textBaseline="middle";const i=this.getPieceText(e);this.context.fillText(i,t*this.tileSize+this.tileSize/2,s*this.tileSize+this.tileSize/2)}getPieceText(e){switch(e.type){case"pawn":return e.color==="white"?"♙":"♟";case"rook":return e.color==="white"?"♖":"♜";case"knight":return e.color==="white"?"♘":"♞";case"bishop":return e.color==="white"?"♗":"♝";case"queen":return e.color==="white"?"♕":"♛";case"king":return e.color==="white"?"♔":"♚";default:return""}}handleMouseDown(e){const t=this.canvas.getBoundingClientRect(),s=Math.floor((e.clientX-t.left)/this.tileSize),i=Math.floor((e.clientY-t.top)/this.tileSize),n=this.board.getPiece(s,i);n&&(this.draggingPiece=n,this.startX=s,this.startY=i,this.canvas.style.cursor="grabbing",this.highlightedMoves=this.board.getValidMoves(s,i),this.drawBoard(),this.highlightValidMoves(this.highlightedMoves))}handleMouseMove(e){const t=this.canvas.getBoundingClientRect(),s=Math.floor((e.clientX-t.left)/this.tileSize),i=Math.floor((e.clientY-t.top)/this.tileSize);let n=null;if(this.board.isWithinBounds(s,i)&&(n=this.board.getPiece(s,i)),n&&!this.draggingPiece?this.canvas.style.cursor="pointer":this.draggingPiece||(this.canvas.style.cursor="default"),!this.draggingPiece)return;this.drawBoard(),this.highlightValidMoves(this.highlightedMoves);const r=e.clientX-t.left,c=e.clientY-t.top;this.context.fillStyle=this.draggingPiece.color==="white"?"white":"black",this.context.font="48px Arial",this.context.textAlign="center",this.context.textBaseline="middle";const a=this.getPieceText(this.draggingPiece);this.context.fillText(a,r,c)}handleMouseUp(e){if(!this.draggingPiece||this.startX===null||this.startY===null)return;const t=this.canvas.getBoundingClientRect(),s=Math.floor((e.clientX-t.left)/this.tileSize),i=Math.floor((e.clientY-t.top)/this.tileSize),n=this.moveHandler(this.startX,this.startY,s,i);this.draggingPiece=null,this.startX=null,this.startY=null,this.canvas.style.cursor="default",this.highlightedMoves=[],this.drawBoard(),n&&this.drawBoard()}}class D{constructor(e,t){f(this,"intervalId",null);f(this,"currentTime");f(this,"onTimeUpdate");f(this,"isRunning",!1);this.initialTime=e,this.currentTime=e,this.onTimeUpdate=t}start(){this.isRunning||(this.isRunning=!0,this.intervalId=window.setInterval(()=>{this.currentTime--,this.onTimeUpdate(this.currentTime),this.currentTime<=0&&(this.currentTime=0,this.stop(),this.onTimeUpdate(this.currentTime))},1e3))}stop(){this.isRunning&&(this.intervalId!==null&&(clearInterval(this.intervalId),this.intervalId=null),this.isRunning=!1)}reset(e){this.stop(),this.currentTime=e,this.start()}}const q=new re,I=q.getBoard(),ce=document.getElementById("moveHistory"),le=document.getElementById("currentTurn"),ae=document.getElementById("timer"),A=document.getElementById("passTurnButton"),G=document.getElementById("gameMessage"),S=document.getElementById("replayButton");let P=o.WHITE,K="playing",U=!1,L=[[]],N=!1,B=new D(60,l=>Q(l,o.WHITE)),k=new D(60,l=>Q(l,o.BLACK));function Q(l,e){e===P&&(ae.textContent=`Temps restant: ${l}s`,l<=0&&!N&&(E(),m(`${P===o.WHITE?"Noir":"Blanc"} gagne par temps écoulé !`)))}const z=new oe(I,"chessBoard",fe);z.drawBoard();B.start();function E(){N||(N=!0,B.isRunning&&B.stop(),k.isRunning&&k.stop(),K="waiting",m("La partie est terminée !"),S.style.display="block")}function he(){G.textContent="",G.style.display="none"}function O(){he(),P=P===o.WHITE?o.BLACK:o.WHITE,le.textContent=`Tour actuel: ${P===o.WHITE?"Blanc":"Noir"}`,U=!1,A.disabled=P===o.BLACK,P===o.WHITE?(k.isRunning&&k.stop(),B.reset(60)):(B.isRunning&&B.stop(),k.reset(60)),I.isStalemate(P)&&(E(),m("Pat ! La partie est nulle.")),I.isInsufficientMaterial()&&(E(),m("Matériel insuffisant pour continuer, partie nulle !")),I.isFiftyMoveRule()&&(E(),m("Règle des 50 coups, partie nulle !")),K==="playing"&&(K="playing"),L.push([]),P===o.BLACK&&(q.makeAIMove(),z.drawBoard(),O())}function ue(l,e,t,s,i){const n=`${i} de (${l}, ${e}) à (${t}, ${s})`,r=document.createElement("li");r.textContent=n,ce.appendChild(r),L[L.length-1].push({fromX:l,fromY:e,toX:t,toY:s,pieceType:i})}function fe(l,e,t,s){if(K==="waiting"||U)return m("Veuillez attendre le prochain tour !"),!1;const i=I.getPiece(l,e),n=I.getPiece(t,s);if(!i||i.color!==P)return m(`C'est le tour de ${P===o.WHITE?"Blanc":"Noir"}`),!1;if(i.isValidMove(l,e,t,s,I)){if(I.movePiece(l,e,t,s)){n&&V(n.type,n.color),ue(l,e,t,s,i.type),z.animateMove(l,e,t,s,i);const r=P===o.WHITE?o.BLACK:o.WHITE;return I.isKingInCheck(r)&&(I.isCheckmate(r)?(E(),m(`Échec et Mat ! ${P===o.WHITE?"Blanc":"Noir"} gagne !`)):m(`Échec au ${r===o.WHITE?"Blanc":"Noir"} !`)),O(),!0}return m("Mouvement invalide !"),!1}return!1}A&&A.addEventListener("click",l=>{l.preventDefault(),K==="playing"&&P===o.WHITE&&(m(`Tour passé pour ${P===o.WHITE?"Blanc":"Noir"}`),O())});S&&S.addEventListener("click",()=>{location.reload()});
//# sourceMappingURL=index-sQyn6WXw.js.map
