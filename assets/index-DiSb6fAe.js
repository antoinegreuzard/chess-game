var $=Object.defineProperty;var D=(a,e,t)=>e in a?$(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var h=(a,e,t)=>D(a,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();var l=(a=>(a.WHITE="white",a.BLACK="black",a))(l||{}),f=(a=>(a.PAWN="pawn",a.ROOK="rook",a.KNIGHT="knight",a.BISHOP="bishop",a.QUEEN="queen",a.KING="king",a))(f||{});class w{constructor(e,t){this.color=e,this.type=t}isPathClear(e,t,s,i,n){const r=Math.sign(s-e),c=Math.sign(i-t);let o=e+r,u=t+c;for(;o!==s||u!==i;){if(n.getPiece(o,u))return!1;o+=r,u+=c}return!0}canCapture(e,t,s){const i=s.getPiece(e,t);return i===null||i.color!==this.color}}class v extends w{constructor(t){super(t,f.ROOK);h(this,"hasMoved",!1)}isValidMove(t,s,i,n,r){return(t===i||s===n)&&this.isPathClear(t,s,i,n,r)?this.canCapture(i,n,r):!1}}class B extends w{constructor(e){super(e,f.KNIGHT)}isValidMove(e,t,s,i,n){const r=Math.abs(s-e),c=Math.abs(i-t);return(r===2&&c===1||r===1&&c===2)&&this.canCapture(s,i,n)}}class x extends w{constructor(e){super(e,f.BISHOP)}isValidMove(e,t,s,i,n){return Math.abs(s-e)===Math.abs(i-t)&&this.isPathClear(e,t,s,i,n)?this.canCapture(s,i,n):!1}}class S extends w{constructor(e){super(e,f.QUEEN)}isValidMove(e,t,s,i,n){return(e===s||t===i||Math.abs(s-e)===Math.abs(i-t))&&this.isPathClear(e,t,s,i,n)?this.canCapture(s,i,n):!1}}class C extends w{constructor(t){super(t,f.KING);h(this,"hasMoved",!1)}isValidMove(t,s,i,n,r){const c=Math.abs(i-t),o=Math.abs(n-s);if(c<=1&&o<=1){const u=r.getPiece(i,n);return this.canCapture(i,n,r)&&(!u||u.type!==f.KING)}if(!this.hasMoved&&o===0&&c===2){const u=i>t?1:-1,H=i>t?7:0,T=r.getPiece(H,s);if(T&&T instanceof v&&!T.hasMoved){for(let y=t+u;y!==H;y+=u)if(r.getPiece(y,s))return!1;if(!r.isKingInCheck(this.color)&&!r.isSquareUnderAttack(t+u,s,this.color)&&!r.isSquareUnderAttack(i,s,this.color))return!0}}return!1}}class m extends w{constructor(e){super(e,f.PAWN)}isValidMove(e,t,s,i,n){const r=this.color===l.WHITE?1:-1,c=this.color===l.WHITE?1:6,o=(i-t)*r,u=Math.abs(s-e);if(u===0&&o===1&&!n.getPiece(s,i))return(this.color===l.WHITE&&i===7||this.color===l.BLACK&&i===0)&&this.handlePromotion(s,i,n),!0;if(u===0&&o===2&&t===c&&!n.getPiece(s,i)&&!n.getPiece(e,t+r))return n.updateEnPassantTarget(e,t,s,i,this),!0;if(u===1&&o===1){if(this.canCapture(s,i,n))return(this.color===l.WHITE&&i===7||this.color===l.BLACK&&i===0)&&this.handlePromotion(s,i,n),!0;if(n.isEnPassantMove(e,t,s,i))return n.captureEnPassant(e,t,s,i),!0}return!1}handlePromotion(e,t,s){const i=document.getElementById("promotionDialog");i&&(i.style.display="block",window.promote=n=>{i.style.display="none",s.promotePawn(e,t,n)})}}class q{constructor(){h(this,"grid");h(this,"enPassantTarget",null);h(this,"halfMoveCount",0);this.grid=this.initializeBoard()}initializeBoard(){const e=Array(8).fill(null).map(()=>Array(8).fill(null));return e[0]=[new v(l.WHITE),new B(l.WHITE),new x(l.WHITE),new S(l.WHITE),new C(l.WHITE),new x(l.WHITE),new B(l.WHITE),new v(l.WHITE)],e[1]=Array(8).fill(null).map(()=>new m(l.WHITE)),e[7]=[new v(l.BLACK),new B(l.BLACK),new x(l.BLACK),new S(l.BLACK),new C(l.BLACK),new x(l.BLACK),new B(l.BLACK),new v(l.BLACK)],e[6]=Array(8).fill(null).map(()=>new m(l.BLACK)),e}getPiece(e,t){return this.grid[t][e]}getValidMoves(e,t){const s=this.getPiece(e,t);if(!s)return[];const i=[];for(let n=0;n<8;n++)for(let r=0;r<8;r++)s.isValidMove(e,t,r,n,this)&&i.push({x:r,y:n});return i}getKingInCheck(){return this.isKingInCheck(l.WHITE)?this.findKing(l.WHITE):this.isKingInCheck(l.BLACK)?this.findKing(l.BLACK):null}movePiece(e,t,s,i){if(i<0||i>=this.grid.length||["__proto__","constructor","prototype"].includes(i.toString()))return!1;const n=this.getPiece(e,t);if(n&&n.isValidMove(e,t,s,i,this)){const r=this.getPiece(s,i);if(r&&r.type===f.KING)return!1;const c=this.getPiece(s,i);if(this.grid[i][s]=n,this.grid[t][e]=null,this.isKingInCheck(n.color))return this.grid[t][e]=n,this.grid[i][s]=c,!1;if(n instanceof C&&Math.abs(s-e)===2){if(!this.isCastlingValid(n,e,t,s))return!1;this.handleCastling(s,i)}return this.handleEnPassant(e,t,s,i),n.type===f.PAWN||r?this.halfMoveCount=0:this.halfMoveCount++,this.grid[i][s]=n,this.grid[t][e]=null,(n instanceof C||n instanceof v)&&(n.hasMoved=!0),this.updateEnPassantTarget(e,t,s,i,n),!0}return!1}isCastlingValid(e,t,s,i){const n=i>t?1:-1,r=i>t?7:0,c=this.getPiece(r,s);if(!(c instanceof v)||c.hasMoved||e.hasMoved)return!1;for(let o=t+n;o!==r;o+=n)if(this.getPiece(o,s))return!1;for(let o=t;o!==i+n;o+=n)if(this.isSquareUnderAttack(o,s,e.color))return!1;return!0}handleCastling(e,t){if(e===6){const s=this.getPiece(7,t);s instanceof v&&(this.grid[5][t]=s,this.grid[7][t]=null)}else if(e===2){const s=this.getPiece(0,t);s instanceof v&&(this.grid[3][t]=s,this.grid[0][t]=null)}}handleEnPassant(e,t,s,i){var n;if(this.isEnPassantMove(e,t,s,i)){const r=((n=this.getPiece(e,t))==null?void 0:n.color)===l.WHITE?-1:1;this.grid[i-r][s]=null}}updateEnPassantTarget(e,t,s,i,n){n instanceof m&&Math.abs(i-t)===2&&e===s?this.enPassantTarget={x:s,y:(t+i)/2}:this.enPassantTarget=null}captureEnPassant(e,t,s,i){const n=this.getPiece(e,t);if(this.isEnPassantMove(e,t,s,i)&&n instanceof m){const r=n.color===l.WHITE?-1:1;this.grid[i-r][s]=null}}isEnPassantMove(e,t,s,i){return this.enPassantTarget?s===this.enPassantTarget.x&&i===this.enPassantTarget.y&&this.getPiece(e,t)instanceof m:!1}promotePawn(e,t,s){var n;const i=(n=this.getPiece(e,t))==null?void 0:n.color;if(i)switch(s){case"queen":this.grid[t][e]=new S(i);break;case"rook":this.grid[t][e]=new v(i);break;case"bishop":this.grid[t][e]=new x(i);break;case"knight":this.grid[t][e]=new B(i);break}}isKingInCheck(e){const t=this.findKing(e);if(!t)return!1;for(let s=0;s<8;s++)for(let i=0;i<8;i++){const n=this.getPiece(i,s);if(n&&n.color!==e&&n.isValidMove(i,s,t.x,t.y,this))return!0}return!1}isCheckmate(e){if(!this.isKingInCheck(e))return!1;for(let t=0;t<8;t++)for(let s=0;s<8;s++){const i=this.getPiece(s,t);if(i&&i.color===e){for(let n=0;n<8;n++)for(let r=0;r<8;r++)if(i.isValidMove(s,t,r,n,this)){const c=this.getPiece(r,n);this.grid[n][r]=i,this.grid[t][s]=null;const o=!this.isKingInCheck(e);if(this.grid[t][s]=i,this.grid[n][r]=c,o)return!1}}}return!0}isStalemate(e){if(this.isKingInCheck(e))return!1;for(let t=0;t<8;t++)for(let s=0;s<8;s++){const i=this.getPiece(s,t);if(i&&i.color===e){for(let n=0;n<8;n++)for(let r=0;r<8;r++)if(i.isValidMove(s,t,r,n,this)){const c=this.getPiece(r,n);this.grid[n][r]=i,this.grid[t][s]=null;const o=!this.isKingInCheck(e);if(this.grid[t][s]=i,this.grid[n][r]=c,o)return!1}}}return!0}findKing(e){for(let t=0;t<8;t++)for(let s=0;s<8;s++){const i=this.getPiece(s,t);if(i&&i instanceof C&&i.color===e)return{x:s,y:t}}return null}isSquareUnderAttack(e,t,s){for(let i=0;i<8;i++)for(let n=0;n<8;n++){const r=this.getPiece(n,i);if(r&&r.color!==s&&r.isValidMove(n,i,e,t,this))return!0}return!1}isInsufficientMaterial(){const e=this.grid.flat().filter(t=>t!==null);return e.length<=2?!0:e.length===3&&e.some(t=>(t==null?void 0:t.type)===f.BISHOP||(t==null?void 0:t.type)===f.KNIGHT)}isFiftyMoveRule(){return this.halfMoveCount>=50}setPiece(e,t,s){this.grid[t][e]=s}}class G{constructor(){h(this,"board");this.board=new q}start(){console.log("Nouvelle partie d'échecs démarrée !")}getBoard(){return this.board}}class F{constructor(e,t,s){h(this,"canvas");h(this,"context");h(this,"tileSize");h(this,"draggingPiece",null);h(this,"startX",null);h(this,"startY",null);h(this,"highlightedMoves",[]);h(this,"kingInCheckPosition",null);this.board=e,this.moveHandler=s,this.canvas=document.getElementById(t),this.context=this.canvas.getContext("2d"),this.tileSize=this.canvas.width/8,this.canvas.style.cursor="default",this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this))}animateMove(e,t,s,i,n){let c=0;const o=e*this.tileSize,u=t*this.tileSize,H=(s-e)*this.tileSize/10,T=(i-t)*this.tileSize/10,y=()=>{c<=10?(this.drawBoard(),this.context.fillStyle=n.color===l.WHITE?"white":"black",this.context.font="48px Arial",this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText(this.getPieceText(n),o+H*c+this.tileSize/2,u+T*c+this.tileSize/2),c++,requestAnimationFrame(y)):this.drawBoard()};y()}highlightValidMoves(e){this.context.fillStyle="rgba(0, 255, 0, 0.5)",e.forEach(t=>{this.context.fillRect(t.x*this.tileSize,t.y*this.tileSize,this.tileSize,this.tileSize)})}drawBoard(){const e=this.board.getKingInCheck();this.kingInCheckPosition=e?{x:e.x,y:e.y}:null,this.drawTiles(),this.drawPieces()}drawTiles(){for(let e=0;e<8;e++)for(let t=0;t<8;t++){let i=(t+e)%2===1?"#769656":"#eeeed2";this.kingInCheckPosition&&this.kingInCheckPosition.x===t&&this.kingInCheckPosition.y===e&&(i="#ff6347"),this.context.fillStyle=i,this.context.fillRect(t*this.tileSize,e*this.tileSize,this.tileSize,this.tileSize)}}drawPieces(){for(let e=0;e<8;e++)for(let t=0;t<8;t++){const s=this.board.getPiece(t,e);s&&this.drawPiece(s,t,e)}}drawPiece(e,t,s){this.context.fillStyle=e.color==="white"?"white":"black",this.context.font="48px Arial",this.context.textAlign="center",this.context.textBaseline="middle";const i=this.getPieceText(e);this.context.fillText(i,t*this.tileSize+this.tileSize/2,s*this.tileSize+this.tileSize/2)}getPieceText(e){switch(e.type){case"pawn":return e.color==="white"?"♙":"♟";case"rook":return e.color==="white"?"♖":"♜";case"knight":return e.color==="white"?"♘":"♞";case"bishop":return e.color==="white"?"♗":"♝";case"queen":return e.color==="white"?"♕":"♛";case"king":return e.color==="white"?"♔":"♚";default:return""}}handleMouseDown(e){const t=this.canvas.getBoundingClientRect(),s=Math.floor((e.clientX-t.left)/this.tileSize),i=Math.floor((e.clientY-t.top)/this.tileSize),n=this.board.getPiece(s,i);n&&(this.draggingPiece=n,this.startX=s,this.startY=i,this.canvas.style.cursor="grabbing",this.highlightedMoves=this.board.getValidMoves(s,i),this.drawBoard(),this.highlightValidMoves(this.highlightedMoves))}handleMouseMove(e){const t=this.canvas.getBoundingClientRect(),s=Math.floor((e.clientX-t.left)/this.tileSize),i=Math.floor((e.clientY-t.top)/this.tileSize);if(this.board.getPiece(s,i)&&!this.draggingPiece?this.canvas.style.cursor="pointer":this.draggingPiece||(this.canvas.style.cursor="default"),!this.draggingPiece)return;this.drawBoard(),this.highlightValidMoves(this.highlightedMoves);const r=e.clientX-t.left,c=e.clientY-t.top;this.context.fillStyle=this.draggingPiece.color==="white"?"white":"black",this.context.font="48px Arial",this.context.textAlign="center",this.context.textBaseline="middle";const o=this.getPieceText(this.draggingPiece);this.context.fillText(o,r,c)}handleMouseUp(e){if(!this.draggingPiece||this.startX===null||this.startY===null)return;const t=this.canvas.getBoundingClientRect(),s=Math.floor((e.clientX-t.left)/this.tileSize),i=Math.floor((e.clientY-t.top)/this.tileSize),n=this.moveHandler(this.startX,this.startY,s,i);this.draggingPiece=null,this.startX=null,this.startY=null,this.canvas.style.cursor="default",this.highlightedMoves=[],this.drawBoard(),n&&this.drawBoard()}}class V{constructor(e,t){h(this,"intervalId",null);h(this,"currentTime");h(this,"onTimeUpdate");h(this,"isRunning",!1);this.initialTime=e,this.currentTime=e,this.onTimeUpdate=t}start(){this.isRunning||(console.log("Timer started."),this.isRunning=!0,this.intervalId=window.setInterval(()=>{this.currentTime--,this.onTimeUpdate(this.currentTime),this.currentTime<=0&&(this.currentTime=0,this.stop(),this.onTimeUpdate(this.currentTime))},1e3))}stop(){this.isRunning&&(console.log("Stopping timer."),this.intervalId!==null&&(clearInterval(this.intervalId),this.intervalId=null),this.isRunning=!1)}reset(e){console.log("Resetting timer to",e),this.stop(),this.currentTime=e,this.start()}}function d(a){const e=document.getElementById("gameMessage");e.textContent=a,e.style.display="block"}const _=new G,p=_.getBoard(),Q=document.getElementById("moveHistory"),j=document.getElementById("currentTurn"),J=document.getElementById("timer"),Z=document.getElementById("capturedWhite"),X=document.getElementById("capturedBlack"),Y=document.getElementById("passTurnButton"),z=document.getElementById("gameMessage"),O=document.getElementById("replayButton"),ee=document.getElementById("drawButton"),te=document.getElementById("undoButton"),K=document.getElementById("acceptDrawButton");let g=l.WHITE,P="playing",W=!1,N=[],R=[],I=[[]],A=!1,M=new V(60,a=>U(a,l.WHITE)),k=new V(60,a=>U(a,l.BLACK));function U(a,e){e===g&&(J.textContent=`Temps restant: ${a}s`,a<=0&&!A&&(d(`${g===l.WHITE?"Noir":"Blanc"} gagne par temps écoulé !`),E()))}const b=new F(p,"chessBoard",ae);b.drawBoard();M.start();function E(){A||(A=!0,M.isRunning&&M.stop(),k.isRunning&&k.stop(),P="waiting",d("La partie est terminée !"),O.style.display="block")}function ie(){z.textContent="",z.style.display="none"}function L(){ie(),g=g===l.WHITE?l.BLACK:l.WHITE,j.textContent=`Tour actuel: ${g===l.WHITE?"Blanc":"Noir"}`,W=!1,g===l.WHITE?(k.isRunning&&k.stop(),M.reset(60)):(M.isRunning&&M.stop(),k.reset(60)),p.isStalemate(g)&&(d("Pat ! La partie est nulle."),E()),p.isInsufficientMaterial()&&(d("Matériel insuffisant pour continuer, partie nulle !"),E()),p.isFiftyMoveRule()&&(d("Règle des 50 coups, partie nulle !"),E()),P==="drawProposed"?K.style.display="block":K.style.display="none",P==="playing"&&(P="playing"),I.push([])}function se(a,e,t,s,i){const n=`${i} de (${a}, ${e}) à (${t}, ${s})`,r=document.createElement("li");r.textContent=n,Q.appendChild(r),I[I.length-1].push({fromX:a,fromY:e,toX:t,toY:s,pieceType:i})}function ne(a,e){const t=re(a,e);e===l.WHITE?(N.push(t),Z.textContent=N.join(" ")):(R.push(t),X.textContent=R.join(" "))}function re(a,e){switch(a){case"pawn":return e===l.WHITE?"♙":"♟";case"rook":return e===l.WHITE?"♖":"♜";case"knight":return e===l.WHITE?"♘":"♞";case"bishop":return e===l.WHITE?"♗":"♝";case"queen":return e===l.WHITE?"♕":"♛";case"king":return e===l.WHITE?"♔":"♚";default:return""}}function ae(a,e,t,s){if(P==="waiting"||W)return d("Veuillez attendre le prochain tour !"),!1;const i=p.getPiece(a,e),n=p.getPiece(t,s);if(!i||i.color!==g)return d(`Ce n'est pas le tour de ${g===l.WHITE?"Blanc":"Noir"}`),!1;if(i.isValidMove(a,e,t,s,p)&&p.movePiece(a,e,t,s)){W=!0,n&&ne(n.type,n.color),se(a,e,t,s,i.type),b.animateMove(a,e,t,s,i);const r=g===l.WHITE?l.BLACK:l.WHITE;return p.isKingInCheck(r)&&(p.isCheckmate(r)?(d(`Échec et Mat ! ${g===l.WHITE?"Blanc":"Noir"} gagne !`),E()):d(`Échec au ${r===l.WHITE?"Blanc":"Noir"} !`)),L(),!0}return d("Mouvement invalide !"),!1}Y.addEventListener("click",a=>{a.preventDefault(),P==="playing"&&(d(`Tour passé pour ${g===l.WHITE?"Blanc":"Noir"}`),L())});O.addEventListener("click",()=>{location.reload()});ee.addEventListener("click",()=>{P==="playing"&&(d("Proposition de nullité faite. Attente de la réponse de l'adversaire."),P="drawProposed",L())});K.addEventListener("click",()=>{P==="drawProposed"&&(d("Partie Nulle par Accord Mutuel !"),P="waiting",E())});te.addEventListener("click",()=>{if(P==="playing"&&I.length>0){const a=I[I.length-1];if(a.length>0){const e=a.pop();e&&(p.movePiece(e.toX,e.toY,e.fromX,e.fromY),d("Dernier coup annulé !"),b.drawBoard())}a.length===0&&I.length>1&&I.pop()}});
//# sourceMappingURL=index-DiSb6fAe.js.map
