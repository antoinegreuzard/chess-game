(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();const q="modulepreload",Q=function(h){return"/chess-game/pr-266/"+h},_={},x=function(t,e,s){let i=Promise.resolve();if(e&&e.length>0){let r=function(d){return Promise.all(d.map(I=>Promise.resolve(I).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=o?.nonce||o?.getAttribute("nonce");i=r(e.map(d=>{if(d=Q(d),d in _)return;_[d]=!0;const I=d.endsWith(".css"),g=I?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${g}`))return;const y=document.createElement("link");if(y.rel=I?"stylesheet":q,I||(y.as="script"),y.crossOrigin="",y.href=d,c&&y.setAttribute("nonce",c),document.head.appendChild(y),I)return new Promise((T,v)=>{y.addEventListener("load",T),y.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${d}`)))})}))}function n(r){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=r,window.dispatchEvent(o),!o.defaultPrevented)throw r}return i.then(r=>{for(const o of r||[])o.status==="rejected"&&n(o.reason);return t().catch(n)})};async function f(h,t){switch(h){case a.PAWN:const{Pawn:e}=await x(async()=>{const{Pawn:c}=await import("./pawn-bGoP7QA1.js");return{Pawn:c}},[]);return new e(t);case a.ROOK:const{Rook:s}=await x(async()=>{const{Rook:c}=await import("./rook-Dcgbny9r.js");return{Rook:c}},[]);return new s(t);case a.KNIGHT:const{Knight:i}=await x(async()=>{const{Knight:c}=await import("./knight-DKH5E8a0.js");return{Knight:c}},[]);return new i(t);case a.BISHOP:const{Bishop:n}=await x(async()=>{const{Bishop:c}=await import("./bishop-PuuQA4Kq.js");return{Bishop:c}},[]);return new n(t);case a.QUEEN:const{Queen:r}=await x(async()=>{const{Queen:c}=await import("./queen-DyT4I7Dm.js");return{Queen:c}},[]);return new r(t);case a.KING:const{King:o}=await x(async()=>{const{King:c}=await import("./king-Zd1FabMc.js");return{King:c}},[]);return new o(t);default:throw new Error(`Type de pièce inconnu : ${h}`)}}var l=(h=>(h.WHITE="white",h.BLACK="black",h))(l||{}),a=(h=>(h.PAWN="pawn",h.ROOK="rook",h.KNIGHT="knight",h.BISHOP="bishop",h.QUEEN="queen",h.KING="king",h))(a||{});class F{constructor(t,e){this.color=t,this.type=e}hasMoved=!1;isPathClear(t,e,s,i,n){const r=Math.sign(s-t),o=Math.sign(i-e);let c=t+r,d=e+o;for(;c!==s||d!==i;){if(n.getPiece(c,d)!==null)return!1;c+=r,d+=o}return!0}static isKing(t){return t.type==="king"}canCapture(t,e,s){const i=s.getPiece(t,e);return!i||i.color!==this.color}toData(){return{color:this.color,type:this.type}}static async fromData(t){return await f(t.type,t.color)}isThreatenedMove(t,e,s,i){const n=Math.abs(s-t),r=Math.abs(i-e);return n<=1&&r<=1}}let z=[],G=[];function C(h){const t=document.getElementById("gameMessage");t&&(t.textContent=h,t.style.display="block")}function D(h,t){switch(h){case a.PAWN:return t===l.WHITE?"♙":"♟";case a.ROOK:return t===l.WHITE?"♖":"♜";case a.KNIGHT:return t===l.WHITE?"♘":"♞";case a.BISHOP:return t===l.WHITE?"♗":"♝";case a.QUEEN:return t===l.WHITE?"♕":"♛";case a.KING:return t===l.WHITE?"♔":"♚";default:return""}}function b(h,t){const e=D(h,t);t===l.WHITE?z.push(e):G.push(e),j()}function j(){const h=document.getElementById("capturedWhite"),t=document.getElementById("capturedBlack");h&&(h.textContent=z.join(" ")),t&&(t.textContent=G.join(" "))}class A{grid;enPassantTarget=null;halfMoveCount=0;currentPlayer=l.WHITE;flipBoard=!1;constructor(){this.grid=Array(8).fill(null).map(()=>Array(8).fill(null))}async init(){this.grid=await this.initializeBoard()}setFlipBoard(t){this.flipBoard=t}async initializeBoard(){const t=Array(8).fill(null).map(()=>Array(8).fill(null));return t[0]=[await f(a.ROOK,l.BLACK),await f(a.KNIGHT,l.BLACK),await f(a.BISHOP,l.BLACK),await f(a.QUEEN,l.BLACK),await f(a.KING,l.BLACK),await f(a.BISHOP,l.BLACK),await f(a.KNIGHT,l.BLACK),await f(a.ROOK,l.BLACK)],t[1]=await Promise.all(Array(8).fill(null).map(()=>f(a.PAWN,l.BLACK))),t[7]=[await f(a.ROOK,l.WHITE),await f(a.KNIGHT,l.WHITE),await f(a.BISHOP,l.WHITE),await f(a.QUEEN,l.WHITE),await f(a.KING,l.WHITE),await f(a.BISHOP,l.WHITE),await f(a.KNIGHT,l.WHITE),await f(a.ROOK,l.WHITE)],t[6]=await Promise.all(Array(8).fill(null).map(()=>f(a.PAWN,l.WHITE))),t}isWithinBounds(t,e){return t>=0&&t<8&&e>=0&&e<8}getPiece(t,e){return this.grid[e][t]}getValidMoves(t,e){let s=null;if(this.isWithinBounds(t,e)&&(s=this.getPiece(t,e)),!s)return[];const i=[];for(let n=0;n<8;n++)for(let r=0;r<8;r++)s.isValidMove(t,e,r,n,this)&&i.push({x:r,y:n});return i}captureEnPassantIfValid(t,e,s,i){if(this.isEnPassantMove(t,e,s,i)){const n=this.getPiece(t,e);if(!n)return;const r=i+(n.color===l.WHITE?-1:1);this.grid[r][s]&&(this.grid[r][s]=null)}}getKingInCheck(){return this.isKingInCheck(l.WHITE)?this.findKing(l.WHITE):this.isKingInCheck(l.BLACK)?this.findKing(l.BLACK):null}movePiece(t,e,s,i,n=!0){if(!this.isWithinBounds(t,e)||!this.isWithinBounds(s,i)||["__proto__","constructor","prototype"].includes(e.toString())||["__proto__","constructor","prototype"].includes(i.toString()))return!1;const r=this.getPiece(t,e);if(r&&r.isValidMove(t,e,s,i,this)){const o=this.getPiece(s,i);if(o&&o.type===a.KING)return!1;if(r.type===a.KING&&Math.abs(s-t)===2)return this.isCastlingValid(r,t,e,s)?(this.handleCastling(s,e),r.hasMoved=!0,!0):!1;if(r?.type===a.PAWN&&this.isEnPassantMove(t,e,s,i)&&this.captureEnPassant(t,e,s,i),this.grid[i][s]=r,this.grid[e][t]=null,n||(r.hasMoved=!0),this.isKingInCheck(r.color))return this.grid[e][t]=r,this.grid[i][s]=o,!1;(r.type===a.KING||r.type===a.ROOK)&&(r.hasMoved=!0),this.updateEnPassantTarget(t,e,s,i,r),this.halfMoveCount=r.type===a.PAWN||o?0:this.halfMoveCount+1;const c=r.color===l.WHITE?l.BLACK:l.WHITE;return this.isCheckmate(c),!0}return!1}isCastlingValid(t,e,s,i){const n=i>e?1:-1,r=i>e?7:0,o=this.getPiece(r,s);if(o?.type!==a.ROOK||o.hasMoved||t.hasMoved)return!1;for(let c=e+n;c!==i+n;c+=n)if(this.getPiece(c,s)||this.isSquareUnderAttack(c,s,t.color))return!1;return!0}handleCastling(t,e){if(t===6){const s=this.getPiece(7,e),i=this.getPiece(4,e);s?.type===a.ROOK&&!s.hasMoved&&i?.type===a.KING&&!i.hasMoved&&(this.setPiece(5,e,s),this.setPiece(7,e,null),this.setPiece(6,e,i),this.setPiece(4,e,null),i.hasMoved=!0,s.hasMoved=!0)}else if(t===2){const s=this.getPiece(0,e),i=this.getPiece(4,e);s?.type===a.ROOK&&!s.hasMoved&&i?.type===a.KING&&!i.hasMoved&&(this.setPiece(3,e,s),this.setPiece(0,e,null),this.setPiece(2,e,i),this.setPiece(4,e,null),i.hasMoved=!0,s.hasMoved=!0)}}updateEnPassantTarget(t,e,s,i,n){n?.type===a.PAWN&&Math.abs(i-e)===2&&t===s?this.enPassantTarget={x:s,y:(e+i)/2}:this.enPassantTarget=null}captureEnPassant(t,e,s,i){const n=this.getPiece(t,e);if(this.isEnPassantMove(t,e,s,i)&&n?.type===a.PAWN){const r=n.color===l.WHITE?-1:1,o=i+r,c=this.getPiece(s,o);if(c&&c.type===a.PAWN){this.grid[o][s]=null;const d={capturedWhite:[],capturedBlack:[]};return c.color===l.WHITE?d.capturedWhite.push(c.type):d.capturedBlack.push(c.type),b(c.type,c.color),d}}return null}isEnPassantMove(t,e,s,i){return this.enPassantTarget?this.getPiece(t,e)?.type===a.PAWN&&s===this.enPassantTarget.x&&i===this.enPassantTarget.y&&Math.abs(t-s)===1&&Math.abs(e-i)===1:!1}async promotePawn(t,e,s){const i=this.getPiece(t,e)?.color;if(i)switch(s){case"queen":this.grid[e][t]=await f(a.QUEEN,i);break;case"rook":this.grid[e][t]=await f(a.ROOK,i);break;case"bishop":this.grid[e][t]=await f(a.BISHOP,i);break;case"knight":this.grid[e][t]=await f(a.KNIGHT,i);break}}isKingInCheck(t){const e=this.findKing(t);if(!e)return!1;for(let s=0;s<8;s++)for(let i=0;i<8;i++){const n=this.getPiece(i,s);if(n&&n.color!==t&&n.isValidMove(i,s,e.x,e.y,this))return!0}return!1}isCheckmate(t){if(!this.isKingInCheck(t))return!1;for(let s=0;s<8;s++)for(let i=0;i<8;i++){const n=this.getPiece(i,s);if(n&&n.color===t){const r=this.getValidMoves(i,s);for(const o of r){const c=this.getPiece(o.x,o.y);this.grid[o.y][o.x]=n,this.grid[s][i]=null;const d=!this.isKingInCheck(t);if(this.grid[s][i]=n,this.grid[o.y][o.x]=c,d)return!1}}}return!0}isStalemate(t){if(this.isKingInCheck(t))return!1;for(let e=0;e<8;e++)for(let s=0;s<8;s++){const i=this.getPiece(s,e);if(i&&i.color===t){for(let n=0;n<8;n++)for(let r=0;r<8;r++)if(i.isValidMove(s,e,r,n,this)){const o=this.getPiece(r,n);this.grid[n][r]=i,this.grid[e][s]=null;const c=!this.isKingInCheck(t);if(this.grid[e][s]=i,this.grid[n][r]=o,c)return!1}}}return!0}findKing(t){for(let e=0;e<8;e++)for(let s=0;s<8;s++){const i=this.getPiece(s,e);if(i&&i?.type===a.KING&&i.color===t)return{x:s,y:e}}return null}isKing(t,e){return this.getPiece(t,e)?.type===a.KING}isSquareUnderAttack(t,e,s){for(let i=0;i<8;i++)for(let n=0;n<8;n++){const r=this.getPiece(n,i);if(r&&r.color!==s){if(r.type===a.KING){if(r.isThreatenedMove(n,i,t,e))return!0}else if(r.isValidMove(n,i,t,e,this))return!0}}return!1}isInsufficientMaterial(){const t=this.grid.flat().filter(e=>e!==null);return t.length<=2?!0:t.length===3&&t.some(e=>e?.type===a.BISHOP||e?.type===a.KNIGHT)}isFiftyMoveRule(){return this.halfMoveCount>=50}setPiece(t,e,s){this.grid[e][t]=s}isMoveValid(t,e,s,i){const n=this.getPiece(t,e);if(!n||s<0||s>=8||i<0||i>=8||!n.isValidMove(t,e,s,i,this))return!1;const r=this.getPiece(s,i);return!(r&&r.color===n.color)}isCapture(t,e,s,i){const n=this.isWithinBounds(t,e)?this.getPiece(t,e):null,r=this.isWithinBounds(s,i)?this.getPiece(s,i):null;return n!==null&&r!==null&&n.color!==r.color}static async fromData(t){const e=new A;return await e.init(),e.grid=await Promise.all(t.grid.map(async s=>Promise.all(s.map(async i=>i?await F.fromData(i):null)))),e}toData(){return{grid:this.grid.map(t=>t.map(e=>e?e.toData():null))}}isAdjacentToAnotherKing(t,e,s){const i=[{dx:-1,dy:-1},{dx:-1,dy:0},{dx:-1,dy:1},{dx:0,dy:-1},{dx:0,dy:1},{dx:1,dy:-1},{dx:1,dy:0},{dx:1,dy:1}];for(const{dx:n,dy:r}of i){const o=t+n,c=e+r,d=this.isWithinBounds(o,c)?this.getPiece(o,c):null;if(d?.type===a.KING&&d.color!==s)return!0}return!1}getPieceCount(){return this.grid.flat().filter(t=>t!==null).length}setPlayerColor(t){this.currentPlayer=t}getPlayerColor(){return this.currentPlayer}getCurrentMovesHash(){let t="";for(let e=0;e<8;e++){let s=0;for(let i=0;i<8;i++){const n=this.getPiece(i,e);if(n){s>0&&(t+=s.toString(),s=0);const r=this.getPieceSymbol(n);t+=r}else s++}s>0&&(t+=s.toString()),e<7&&(t+="/")}return t+=` ${this.currentPlayer===l.WHITE?"w":"b"}`,t}getPieceSymbol(t){const e={[a.PAWN]:"p",[a.ROOK]:"r",[a.KNIGHT]:"n",[a.BISHOP]:"b",[a.QUEEN]:"q",[a.KING]:"k"};return t.color===l.WHITE?e[t.type].toUpperCase():e[t.type]}toString(){let t="";for(let e=0;e<8;e++)for(let s=0;s<8;s++){const i=this.getPiece(s,e);i?t+=`${i.color[0]}${i.type[0]}`:t+="__"}return t+=this.enPassantTarget?`e${this.enPassantTarget.x}${this.enPassantTarget.y}`:"e--",t+=`h${this.halfMoveCount}`,t+=`p${this.currentPlayer[0]}`,t}}class J{board;aiWorker;aiColor;lastAIMove=null;constructor(t){this.board=new A,this.aiWorker=new Worker(new URL("/chess-game/pr-266/assets/ai.worker-D7HpxdwJ.js",import.meta.url),{type:"module"}),this.aiColor=t===l.WHITE?l.BLACK:l.WHITE,this.board.setFlipBoard(!1)}async getBoard(){return await this.board.init(),this.board}makeAIMove(){return new Promise(t=>{this.aiWorker.onmessage=async s=>{let{bestMove:i}=s.data,n=await this.isAIMoveLegal(i),r=0;for(;!n&&r<50;)this.aiWorker.postMessage({invalidMove:i}),i=(await new Promise(c=>{this.aiWorker.onmessage=c})).data.bestMove,n=await this.isAIMoveLegal(i),r++;if(n&&i){this.lastAIMove=i;const o=this.board.getPiece(i.toX,i.toY);o&&b(o.type,o.color),this.board.movePiece(i.fromX,i.fromY,i.toX,i.toY,!1)}else console.warn("Aucun coup valide trouvé par l'IA après plusieurs tentatives.");t()};const e=this.board.toData();this.aiWorker.postMessage({boardData:e,aiColor:this.aiColor})})}async isAIMoveLegal(t){const e=await A.fromData(this.board.toData()),s=e.getPiece(t.fromX,t.fromY),i=e.getPiece(t.toX,t.toY);e.setPiece(t.toX,t.toY,s),e.setPiece(t.fromX,t.fromY,null);const n=e.isKingInCheck(this.aiColor);return e.setPiece(t.fromX,t.fromY,s),e.setPiece(t.toX,t.toY,i),!n}getLastAIMove(){return this.lastAIMove}}class Z{constructor(t,e,s,i){if(this.board=t,this.moveHandler=s,this.playerColor=i,this.canvas=document.getElementById(e),!this.canvas)throw new Error(`Canvas with id ${e} not found`);if(this.context=this.canvas.getContext("2d"),!this.context)throw new Error("Canvas context could not be initialized");this.tileSize=this.canvas.width/8,this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this))}canvas;context;tileSize;get flipBoard(){return this.playerColor===l.BLACK}draggingPiece=null;startX=null;startY=null;highlightedMoves=[];kingInCheckPosition=null;getCoordinates(t,e){return this.flipBoard?{x:7-t,y:7-e}:{x:t,y:e}}animateMove(t,e,s,i,n){let o=0;const{x:c,y:d}=this.getCoordinates(t,e),{x:I,y:g}=this.getCoordinates(s,i),y=(I-c)*this.tileSize/10,T=(g-d)*this.tileSize/10,v=()=>{o<=10?(this.drawBoard(),this.context.fillStyle=n.color===l.WHITE?"white":"black",this.context.font="48px Arial",this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText(this.getPieceText(n),c*this.tileSize+y*o+this.tileSize/2,d*this.tileSize+T*o+this.tileSize/2),o++,requestAnimationFrame(v)):this.drawBoard()};v()}highlightValidMoves(t){this.context.fillStyle="rgba(0, 255, 0, 0.5)",t.forEach(e=>{const{x:s,y:i}=this.getCoordinates(e.x,e.y);this.context.fillRect(s*this.tileSize,i*this.tileSize,this.tileSize,this.tileSize)})}drawBoard(){const t=this.board.getKingInCheck();this.kingInCheckPosition=t?this.getCoordinates(t.x,t.y):null,this.drawTiles(),this.drawPieces()}drawTiles(){const t="abcdefgh";for(let e=0;e<8;e++)for(let s=0;s<8;s++){const{x:i,y:n}=this.getCoordinates(s,e);let o=(s+e)%2===1?"#769656":"#eeeed2";this.kingInCheckPosition&&this.kingInCheckPosition.x===i&&this.kingInCheckPosition.y===n&&(o="#ff6347"),this.context.fillStyle=o,this.context.fillRect(i*this.tileSize,n*this.tileSize,this.tileSize,this.tileSize)}this.context.font="16px Arial",this.context.fillStyle="black";for(let e=0;e<8;e++){const s=this.getCoordinates(e,0).x*this.tileSize+this.tileSize/2,i=this.canvas.height-5;this.context.textAlign="center",this.context.fillText(t[e],s,i);const n=5,r=this.getCoordinates(0,e).y*this.tileSize+this.tileSize/2;this.context.textBaseline="middle",this.context.fillText(`${8-e}`,n,r)}}drawPieces(){for(let t=0;t<8;t++)for(let e=0;e<8;e++){const s=this.board.getPiece(e,t);if(s){const{x:i,y:n}=this.getCoordinates(e,t);this.drawPiece(s,i,n)}}}drawPiece(t,e,s){this.context.fillStyle=t.color==="white"?"white":"black",this.context.font="48px Arial",this.context.textAlign="center",this.context.textBaseline="middle";const i=this.getPieceText(t);this.context.fillText(i,e*this.tileSize+this.tileSize/2,s*this.tileSize+this.tileSize/2)}getPieceText(t){switch(t.type){case"pawn":return t.color==="white"?"♙":"♟";case"rook":return t.color==="white"?"♖":"♜";case"knight":return t.color==="white"?"♘":"♞";case"bishop":return t.color==="white"?"♗":"♝";case"queen":return t.color==="white"?"♕":"♛";case"king":return t.color==="white"?"♔":"♚";default:return""}}handleMouseDown(t){const e=this.canvas.getBoundingClientRect(),s=Math.floor((t.clientX-e.left)/this.tileSize),i=Math.floor((t.clientY-e.top)/this.tileSize),n=this.flipBoard?7-s:s,r=this.flipBoard?7-i:i,o=this.board.getPiece(n,r);o&&o.color===this.playerColor?(this.draggingPiece=o,this.startX=n,this.startY=r,this.canvas.style.cursor="grabbing",this.highlightedMoves=this.board.getValidMoves(n,r),this.drawBoard(),this.highlightValidMoves(this.highlightedMoves)):this.draggingPiece=null}handleMouseMove(t){const e=this.canvas.getBoundingClientRect(),s=Math.floor((t.clientX-e.left)/this.tileSize),i=Math.floor((t.clientY-e.top)/this.tileSize);let n=null;if(this.board.isWithinBounds(s,i)&&(n=this.board.getPiece(s,i)),this.canvas.style.cursor=n&&n.color===this.playerColor&&!this.draggingPiece?"pointer":"default",!this.draggingPiece)return;this.drawBoard(),this.highlightValidMoves(this.highlightedMoves);const r=t.clientX-e.left,o=t.clientY-e.top;this.context.fillStyle=this.draggingPiece.color==="white"?"white":"black",this.context.font="48px Arial",this.context.textAlign="center",this.context.textBaseline="middle";const c=this.getPieceText(this.draggingPiece);this.context.fillText(c,r,o)}async handleMouseUp(t){if(!this.draggingPiece||this.startX===null||this.startY===null)return;const e=this.canvas.getBoundingClientRect(),s=Math.floor((t.clientX-e.left)/this.tileSize),i=Math.floor((t.clientY-e.top)/this.tileSize),n=this.startX,r=this.startY,o=this.flipBoard?7-s:s,c=this.flipBoard?7-i:i;this.draggingPiece=null,this.startX=null,this.startY=null,this.canvas.style.cursor="default",await this.moveHandler(n,r,o,c),this.highlightedMoves=[],this.drawBoard()}}class R{intervalId=null;currentTime;onTimeUpdate;isRunning=!1;constructor(t,e){this.currentTime=Math.max(0,t),this.onTimeUpdate=e}start(){this.isRunning||(this.isRunning=!0,this.intervalId=setInterval(()=>{this.currentTime=Math.max(this.currentTime-1,0),this.onTimeUpdate(this.currentTime),this.currentTime<=0&&(this.currentTime=0,this.stop(),this.onTimeUpdate(this.currentTime))},1e3))}stop(){this.isRunning&&(this.intervalId!==null&&(clearInterval(this.intervalId),this.intervalId=null),this.isRunning=!1)}reset(t,e=!0){this.stop(),this.currentTime=Math.max(0,t),this.onTimeUpdate(this.currentTime),e&&this.start()}}async function X(h){let t=[[]];const e=new J(h),s=await e.getBoard();s.flipBoard=!1;const i=document.getElementById("whiteMoves"),n=document.getElementById("blackMoves"),r=document.getElementById("currentTurn"),o=document.getElementById("timer"),c=document.getElementById("passTurnButton"),d=document.getElementById("gameMessage"),I=document.getElementById("replayButton");let g=l.WHITE,y=!1,T=!1,v=!1,M=new R(60,u=>N(u,l.WHITE)),B=new R(60,u=>N(u,l.BLACK));function N(u,P){P===g&&(o.textContent=`Temps restant: ${u}s`,u<=0&&!T&&K(`${g===l.WHITE?"Noir":"Blanc"} gagne par temps écoulé !`))}s.flipBoard=!1;const k=new Z(s,"chessBoard",async(u,P,w,p)=>await U(u,P,w,p),h);k.drawBoard(),h===l.WHITE?M.start():(B.start(),await O());function K(u){C(u),T=!0,I.style.display="block",M.isRunning&&M.stop(),B.isRunning&&B.stop()}function V(){d.textContent="",d.style.display="none"}function $(u,P,w){const p=document.getElementById("promotionDialog");p&&(p.style.display="block",window.promote=m=>{w.promotePawn(u,P,m),p.style.display="none",S(u,P,u,P,a[m.toUpperCase()]),k.drawBoard(),W()})}async function W(){if(V(),g=g===l.WHITE?l.BLACK:l.WHITE,r.textContent=`Tour actuel: ${g===l.WHITE?"Blanc":"Noir"}`,y=!1,c.disabled=g!==h,g===l.WHITE?(B.isRunning&&B.stop(),M.reset(60)):(M.isRunning&&M.stop(),B.reset(60)),s.isKingInCheck(g)){if(s.isCheckmate(g)){K(`${g===l.WHITE?"Noir":"Blanc"} gagne par échec et mat !`);return}}else if(s.isStalemate(g)){K("Pat ! La partie est nulle.");return}else if(s.isInsufficientMaterial()){K("Matériel insuffisant pour continuer, partie nulle !");return}else if(s.isFiftyMoveRule()){K("Règle des 50 coups, partie nulle !");return}t.push([]),g!==h&&await O()}async function O(){v=!0,await e.makeAIMove();const u=e.getLastAIMove();u&&S(u.fromX,u.fromY,u.toX,u.toY,s.getPiece(u.toX,u.toY)?.type||a.PAWN),k.drawBoard(),v=!1,await W()}function S(u,P,w,p,m){const H="abcdefgh",L=`${D(m,g)} de (${H[u]}${8-P}) à (${H[w]}${8-p})`,E=document.createElement("li");E.textContent=L,g===l.WHITE&&i?i.appendChild(E):g===l.BLACK&&n&&n.appendChild(E),t[t.length-1].push({fromX:u,fromY:P,toX:w,toY:p,pieceType:m})}async function U(u,P,w,p){if(y||T)return C("Veuillez attendre le prochain tour !"),!1;const m=s.getPiece(u,P);if(!m||m.color!==h)return!1;if(g!==h)return v||C(`C'est le tour de ${g===l.WHITE?"Blanc":"Noir"}`),!1;if(!m.isValidMove(u,P,w,p,s))return C("Mouvement invalide !"),!1;if(!s.movePiece(u,P,w,p,!1))return C("Mouvement impossible !"),!1;y=!0,m.hasMoved=!0;const E=s.getPiece(w,p);return E&&E!==m&&b(E.type,E.color),m.type===a.PAWN&&(p===0||p===7)?($(w,p,s),await W()):(S(u,P,w,p,m.type),k.animateMove(u,P,w,p,m),await W()),!0}c&&c.addEventListener("click",async u=>{u.preventDefault(),g===h&&!s.isKingInCheck(h)&&(C(`Tour passé pour ${g===l.WHITE?"Blanc":"Noir"}`),await W())}),I&&I.addEventListener("click",()=>{location.reload()})}window.startGame=h=>X(h);export{F as P,a,l as b,f as c};
//# sourceMappingURL=index-A3kKVxWV.js.map
